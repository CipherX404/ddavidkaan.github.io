<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Twitch Bot</title>
  <style>
    body { margin: 20px; background: #0e0e10; color: white; font-family: Arial; }
    .container { display: flex; gap: 20px; }
    .left-column { flex: 1; }
    .right-column { width: 300px; }
    
    .accordion {
      background: #18181b;
      border-radius: 10px;
      margin-bottom: 20px;
      overflow: hidden;
      border: 1px solid #333;
    }
    
    .accordion-header {
      padding: 15px 20px;
      background: #2d2d2d;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 16px;
      font-weight: bold;
    }
    
    .accordion-content {
      padding: 20px;
      display: block;
    }
    
    .accordion-content.hidden {
      display: none;
    }
    
    .arrow {
      font-size: 14px;
    }
    
    #serverOutput { 
      background: #1f1f23;
      height: 250px;
      padding: 12px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
      border-radius: 5px;
      margin: 10px 0;
    }
    
    .status { 
      background: #ff9800;
      color: black;
      padding: 8px;
      border-radius: 5px;
      margin: 10px 0;
      text-align: center;
      font-weight: bold;
    }
    
    input, button { 
      padding: 8px 12px;
      border-radius: 5px;
      border: none;
      margin: 5px 0;
      width: 100%;
      box-sizing: border-box;
    }
    
    input {
      background: #2d2d2d;
      color: white;
      border: 1px solid #444;
    }
    
    button { 
      background: #9146ff;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }
    
    .aralik-item {
      background: #2d2d2d;
      padding: 10px;
      margin: 8px 0;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-left: 4px solid #9146ff;
    }
    
    .aralik-bilgi {
      font-size: 14px;
      flex: 1;
    }
    
    .sil-btn {
      background: #e91916;
      color: white;
      border: none;
      padding: 5px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      margin-left: 10px;
      width: auto;
    }
    
    .sil-btn:hover {
      background: #ff5252;
    }
    
    .form-row {
      display: flex;
      gap: 10px;
      margin: 10px 0;
    }
    
    .form-row input {
      flex: 1;
    }
    
    .form-row button {
      width: auto;
      min-width: 80px;
    }
    
    .komut-listesi {
      font-size: 14px;
      line-height: 1.8;
    }
    
    .komut-listesi div {
      padding: 5px 0;
      border-bottom: 1px solid #333;
    }
    
    /* √áEKƒ∞Lƒ∞≈û STƒ∞LLERƒ∞ */
    .cekilis-controls {
      display: flex;
      gap: 10px;
      margin: 15px 0;
    }
    
    .cekilis-controls button {
      flex: 1;
    }
    
    .baslat-btn { background: #00b03c; }
    .cek-btn { background: #9146ff; }
    .bitir-btn { background: #e91916; }
    
    .baslat-btn:hover { background: #00a035; }
    .cek-btn:hover { background: #7c3ae0; }
    .bitir-btn:hover { background: #c41411; }
    
    .katilimci-list {
      background: rgba(0,0,0,0.3);
      padding: 10px;
      border-radius: 5px;
      max-height: 100px;
      overflow-y: auto;
      margin: 10px 0;
      font-size: 13px;
    }
    
    .kazananlar {
      background: rgba(0, 176, 60, 0.2);
      padding: 15px;
      border-radius: 5px;
      margin: 15px 0;
      border-left: 4px solid #00b03c;
      display: none;
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="left-column">
      <!-- PERF AYARLARI -->
      <div class="accordion">
        <div class="accordion-header" onclick="toggleAccordion('perf')">
          <span>‚ñº Perf Ayarlarƒ±</span>
          <span class="arrow">‚ñº</span>
        </div>
        <div class="accordion-content" id="perf-content">
          <div class="form-row">
            <input type="number" id="aralikMin" placeholder="Min" min="0" max="100" value="94">
            <input type="number" id="aralikMax" placeholder="Max" min="0" max="100" value="100">
            <input type="number" id="aralikSans" placeholder="≈ûans %" min="0" max="100" value="10">
            <button onclick="aralikEkle()">Ekle</button>
          </div>
          <div id="aralikListesi"></div>
        </div>
      </div>
      
      <!-- √áEKƒ∞Lƒ∞≈û -->
      <div class="accordion">
        <div class="accordion-header" onclick="toggleAccordion('cekilis')">
          <span>‚ñº √áekili≈ü</span>
          <span class="arrow">‚ñº</span>
        </div>
        <div class="accordion-content" id="cekilis-content">
          <input type="text" id="cekilisKomut" placeholder="Komut adƒ± (! olmadan)" value="cekilis">
          <input type="number" id="kazananSayisi" placeholder="Kazanan sayƒ±sƒ±" value="1" min="1" max="50">
          
          <div class="cekilis-controls">
            <button class="baslat-btn" onclick="cekilisBaslat()" id="cekilisBaslatBtn">Ba≈ülat</button>
            <button class="cek-btn" onclick="kisiCek()" id="kisiCekBtn" disabled>Ki≈üi √áek</button>
            <button class="bitir-btn" onclick="cekilisBitir()" id="cekilisBitirBtn" disabled>Bitir</button>
          </div>
          
          <div>
            <div style="font-size: 14px; margin: 10px 0;">
              Durum: <span id="cekilisDurum" style="color: #ff9800;">Hazƒ±r</span>
            </div>
            <div style="font-size: 14px; margin: 5px 0;">
              Katƒ±lƒ±mcƒ±: <span id="katilimciSayisi" style="color: #9146ff;">0</span>
            </div>
            <div class="katilimci-list" id="katilimciListesi">Hen√ºz katƒ±lƒ±mcƒ± yok...</div>
          </div>
          
          <div class="kazananlar" id="kazananlarDiv">
            <div style="color: #00b03c; font-weight: bold; margin-bottom: 5px;">üèÜ Kazananlar:</div>
            <div id="kazananlarListesi"></div>
          </div>
        </div>
      </div>
      
      <!-- LOG -->
      <div class="accordion">
        <div class="accordion-header" onclick="toggleAccordion('log')">
          <span>‚ñº Log</span>
          <span class="arrow">‚ñº</span>
        </div>
        <div class="accordion-content" id="log-content">
          <div id="serverOutput"></div>
          <div id="status" class="status">Baƒülantƒ± kuruluyor...</div>
          <div style="display: flex; gap: 10px; margin-top: 10px;">
            <button onclick="baglantiTest()">Test</button>
            <button onclick="perfTestiYap()" style="background:#00b03c;">Perf Test</button>
            <button onclick="tumunuSil()" style="background:#666;">Temizle</button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="right-column">
      <!-- KANAL AYARLARI -->
      <div class="accordion">
        <div class="accordion-header" onclick="toggleAccordion('kanal')">
          <span>‚ñº Kanal Ayarlarƒ±</span>
          <span class="arrow">‚ñº</span>
        </div>
        <div class="accordion-content" id="kanal-content">
          <input type="text" id="channelInput" value="davidrisingg9" placeholder="Kanal adƒ±">
          <button onclick="kanalDegistir()">Kanal Deƒüi≈ütir</button>
          <div style="margin-top: 10px; font-size: 14px;">
            Aktif kanal: <span id="currentChannelDisplay" style="color: #9146ff;">#davidrisingg9</span>
          </div>
        </div>
      </div>
      
      <!-- KOMUTLAR -->
      <div class="accordion">
        <div class="accordion-header" onclick="toggleAccordion('komutlar')">
          <span>‚ñº Komutlar</span>
          <span class="arrow">‚ñº</span>
        </div>
        <div class="accordion-content" id="komutlar-content">
          <div class="komut-listesi">
            <div>!perf - Perf testi</div>
            <div>!dc - Discord linki</div>
            <div>!yt - YouTube linki</div>
            <div>!ref - Referans linki</div>
            <div>!yardƒ±m - T√ºm komutlar</div>
            <div>!cekilis - √áekili≈üe katƒ±l</div>
          </div>
        </div>
      </div>
      
      <!-- COOLDOWN -->
      <div class="accordion">
        <div class="accordion-header" onclick="toggleAccordion('cooldown')">
          <span>‚ñº Cooldown</span>
          <span class="arrow">‚ñº</span>
        </div>
        <div class="accordion-content" id="cooldown-content">
          <input type="number" id="cooldownTime" value="30" min="5" max="300">
          <div style="font-size: 14px; margin-top: 5px; color: #888;">
            Cooldown s√ºresi (saniye)
          </div>
          <button onclick="cooldownGuncelle()" style="margin-top: 10px;">G√ºncelle</button>
        </div>
      </div>
    </div>
  </div>

<script>
// DEƒûƒ∞≈ûKENLER
const oAuth = "oauth:ys8dumlz221s0ocalar8qhsdi2375x";
const user = "cipherx404";
let currentChannel = "davidrisingg9";
let socket;
let yukselmeAraliklari = [
  { min: 95, max: 100, sans: 5 },
  { min: 90, max: 94, sans: 10 },
  { min: 80, max: 89, sans: 15 },
  { min: 70, max: 79, sans: 20 },
  { min: 0, max: 69, sans: 50 }
];
let cooldownSuresi = 30;
let cooldowns = {};

// √áEKƒ∞Lƒ∞≈û DEƒûƒ∞≈ûKENLERƒ∞
let cekilisAktif = false;
let cekilisKomutu = 'cekilis';
let cekilisKatilimcilar = new Set();

// ACCORDION
function toggleAccordion(section) {
  const content = document.getElementById(section + '-content');
  const arrow = content.parentElement.querySelector('.arrow');
  
  content.classList.toggle('hidden');
  arrow.textContent = content.classList.contains('hidden') ? '‚ñ∂' : '‚ñº';
}

// LOG
function logToOutput(msg) {
  const output = document.getElementById('serverOutput');
  const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
  output.innerHTML += `[${time}] ${msg}\n`;
  output.scrollTop = output.scrollHeight;
}

// ARALIK ƒ∞≈ûLEMLERƒ∞
function aralikEkle() {
  const min = parseInt(document.getElementById('aralikMin').value);
  const max = parseInt(document.getElementById('aralikMax').value);
  const sans = parseInt(document.getElementById('aralikSans').value);
  
  if (min >= 0 && max <= 100 && min <= max && sans >= 0 && sans <= 100) {
    yukselmeAraliklari.push({ min, max, sans });
    araliklariGuncelle();
    logToOutput(`Aralƒ±k eklendi: ${min}-${max} (${sans}%)`);
  } else {
    logToOutput('Hata: Min <= Max ve 0-100 arasƒ±nda olmalƒ±!');
  }
}

function aralikSil(index) {
  if (confirm('Bu aralƒ±ƒüƒ± silmek istediƒüinize emin misiniz?')) {
    yukselmeAraliklari.splice(index, 1);
    araliklariGuncelle();
    logToOutput('Aralƒ±k silindi');
  }
}

function tumunuSil() {
  if (confirm('T√úM aralƒ±klarƒ± silmek istediƒüinize emin misiniz?')) {
    yukselmeAraliklari = [];
    araliklariGuncelle();
    logToOutput('T√ºm aralƒ±klar silindi');
  }
}

function araliklariGuncelle() {
  const liste = document.getElementById('aralikListesi');
  liste.innerHTML = '';
  
  yukselmeAraliklari.forEach((aralik, index) => {
    const div = document.createElement('div');
    div.className = 'aralik-item';
    div.innerHTML = `
      <div class="aralik-bilgi">${aralik.min}-${aralik.max}: ${aralik.sans}%</div>
      <button class="sil-btn" onclick="aralikSil(${index})">Sil</button>
    `;
    liste.appendChild(div);
  });
}

// COOLDOWN
function cooldownGuncelle() {
  cooldownSuresi = parseInt(document.getElementById('cooldownTime').value) || 30;
  logToOutput(`Cooldown g√ºncellendi: ${cooldownSuresi}s`);
}

// PERF HESAPLAMA
function hesaplaperf() {
  const toplam = yukselmeAraliklari.reduce((sum, a) => sum + a.sans, 0);
  if (toplam === 0) return Math.floor(Math.random() * 101);
  
  const random = Math.random() * toplam;
  let cumulative = 0;
  
  for (const aralik of yukselmeAraliklari) {
    cumulative += aralik.sans;
    if (random < cumulative) {
      return Math.floor(Math.random() * (aralik.max - aralik.min + 1)) + aralik.min;
    }
  }
  return Math.floor(Math.random() * 101);
}

// √áEKƒ∞Lƒ∞≈û FONKSƒ∞YONLARI
function cekilisBaslat() {
  if (!socket || socket.readyState !== WebSocket.OPEN) {
    alert('√ñnce kanala baƒülanƒ±n!');
    return;
  }
  
  cekilisKomutu = document.getElementById('cekilisKomut').value.trim().toLowerCase();
  if (!cekilisKomutu) {
    alert('Komut adƒ± girin!');
    return;
  }
  
  cekilisAktif = true;
  cekilisKatilimcilar = new Set();
  
  document.getElementById('cekilisBaslatBtn').disabled = true;
  document.getElementById('kisiCekBtn').disabled = false;
  document.getElementById('cekilisBitirBtn').disabled = false;
  document.getElementById('cekilisDurum').textContent = 'Aktif';
  document.getElementById('cekilisDurum').style.color = '#00b03c';
  document.getElementById('katilimciSayisi').textContent = '0';
  document.getElementById('katilimciListesi').innerHTML = 'Hen√ºz katƒ±lƒ±mcƒ± yok...';
  document.getElementById('kazananlarDiv').style.display = 'none';
  
  const response = `üéÅ √áEKƒ∞Lƒ∞≈û BA≈ûLADI! Katƒ±lmak i√ßin !${cekilisKomutu} yazƒ±n!`;
  socket.send(`PRIVMSG #${currentChannel} :${response}`);
  logToOutput(`>>> ${response}`);
}

function kisiCek() {
  if (!cekilisAktif || cekilisKatilimcilar.size === 0) return;
  
  const kazananSayisi = parseInt(document.getElementById('kazananSayisi').value) || 1;
  const katilimcilar = Array.from(cekilisKatilimcilar);
  const kazananlar = [];
  const tempKatilimcilar = [...katilimcilar];
  const secilecekSayi = Math.min(kazananSayisi, tempKatilimcilar.length);
  
  for (let i = 0; i < secilecekSayi; i++) {
    const randomIndex = Math.floor(Math.random() * tempKatilimcilar.length);
    kazananlar.push(tempKatilimcilar[randomIndex]);
    tempKatilimcilar.splice(randomIndex, 1);
  }
  
  document.getElementById('kazananlarDiv').style.display = 'block';
  document.getElementById('kazananlarListesi').innerHTML = kazananlar.join(', ');
  
  const response = `üé≤ ARADAN KAZANANLAR: ${kazananlar.join(', ')}! √áekili≈ü devam ediyor!`;
  socket.send(`PRIVMSG #${currentChannel} :${response}`);
  logToOutput(`>>> ${response}`);
}

function cekilisBitir() {
  if (!cekilisAktif) return;
  
  const kazananSayisi = parseInt(document.getElementById('kazananSayisi').value) || 1;
  const katilimcilar = Array.from(cekilisKatilimcilar);
  
  if (katilimcilar.length === 0) {
    alert('Kimse katƒ±lmadƒ±!');
    return;
  }
  
  const kazananlar = [];
  const tempKatilimcilar = [...katilimcilar];
  const secilecekSayi = Math.min(kazananSayisi, tempKatilimcilar.length);
  
  for (let i = 0; i < secilecekSayi; i++) {
    const randomIndex = Math.floor(Math.random() * tempKatilimcilar.length);
    kazananlar.push(tempKatilimcilar[randomIndex]);
    tempKatilimcilar.splice(randomIndex, 1);
  }
  
  cekilisAktif = false;
  document.getElementById('cekilisBaslatBtn').disabled = false;
  document.getElementById('kisiCekBtn').disabled = true;
  document.getElementById('cekilisBitirBtn').disabled = true;
  document.getElementById('cekilisDurum').textContent = 'Bitti';
  document.getElementById('cekilisDurum').style.color = '#ff9800';
  
  document.getElementById('kazananlarDiv').style.display = 'block';
  document.getElementById('kazananlarListesi').innerHTML = kazananlar.join(', ');
  
  const response = `üèÜ √áEKƒ∞Lƒ∞≈û Bƒ∞TTƒ∞! ${katilimcilar.length} katƒ±lƒ±mcƒ±. KAZANANLAR: ${kazananlar.join(', ')}`;
  socket.send(`PRIVMSG #${currentChannel} :${response}`);
  logToOutput(`>>> ${response}`);
}

function cekiliseKatil(username) {
  if (!cekilisAktif || cekilisKatilimcilar.has(username)) return;
  
  cekilisKatilimcilar.add(username);
  document.getElementById('katilimciSayisi').textContent = cekilisKatilimcilar.size;
  document.getElementById('katilimciListesi').innerHTML = Array.from(cekilisKatilimcilar).join(', ');
  logToOutput(`üéÅ ${username} katƒ±ldƒ±`);
}

// KANAL ƒ∞≈ûLEMLERƒ∞
function updateChannelDisplay() {
  document.getElementById('currentChannelDisplay').textContent = `#${currentChannel}`;
  document.getElementById('channelInput').value = currentChannel;
}

function kanalDegistir() {
  const newChannel = document.getElementById('channelInput').value.trim().toLowerCase();
  if (!newChannel || newChannel === currentChannel) return;
  
  logToOutput(`Kanal deƒüi≈ütiriliyor: #${currentChannel} ‚Üí #${newChannel}`);
  
  if (socket && socket.readyState === WebSocket.OPEN) {
    socket.send(`PART #${currentChannel}`);
  }
  
  currentChannel = newChannel;
  updateChannelDisplay();
  connectToTwitch();
}

// BAƒûLANTI
function connectToTwitch() {
  try {
    socket = new WebSocket('wss://irc-ws.chat.twitch.tv:443');
    
    socket.addEventListener('open', () => {
      socket.send(`PASS ${oAuth}`);
      socket.send(`NICK ${user}`);
      socket.send(`JOIN #${currentChannel}`);
      document.getElementById('status').style.background = '#00b03c';
      document.getElementById('status').textContent = '‚úÖ Baƒülantƒ± kuruldu';
      logToOutput('ü§ñ Twitch Perf Bot ba≈ülatƒ±lƒ±yor...');
      logToOutput('üéÅ √áekili≈ü botu hazƒ±r!');
    });

    socket.addEventListener('message', (event) => {
      const msg = event.data;
      
      if (msg.startsWith('PING')) {
        socket.send('PONG');
        return;
      }
      
      if (msg.includes('PRIVMSG')) {
        const match = msg.match(/:(.+)!.+@.+ PRIVMSG #(.+) :(.+)/);
        if (match) {
          const username = match[1];
          const chatMsg = match[3].toLowerCase().trim();
          
// !perf komutu kƒ±smƒ±nƒ± bununla deƒüi≈ütir:
if (chatMsg === '!perf') {
  const now = Date.now();
  const lastUsed = cooldowns[username];
  
  // Cooldown kontrol√º
  if (lastUsed) {
    const gecenSure = now - lastUsed;
    const cooldownMs = cooldownSuresi * 1000;
    
    if (gecenSure < cooldownMs) {
      // Cooldown devam ediyor
      const remaining = Math.ceil((cooldownMs - gecenSure) / 1000);
      const response = `@${username} ‚ùå ${remaining}s cooldown!`;
      socket.send(`PRIVMSG #${currentChannel} :${response}`);
      logToOutput(`Cooldown: ${username} - ${remaining}s kaldƒ±`);
      return; // Burada bitir, devam etme!
    }
  }
  
  // Cooldown yok veya s√ºresi ge√ßmi≈ü - perf hesapla ve g√∂nder
  cooldowns[username] = now; // Yeni zamanƒ± kaydet
  
  const perf = hesaplaperf();
  let response;
  
  if (perf >= 95) response = `@${username} üåüüíé EFSANEVƒ∞! ${perf}% √ßƒ±ktƒ±! üéä`;
  else if (perf >= 90) response = `@${username} üéâ‚ú® EPƒ∞K! ${perf}% √ßƒ±ktƒ±! üî•`;
  else if (perf >= 80) response = `@${username} üíú NADƒ∞R! ${perf}% √ßƒ±ktƒ±! üëè`;
  else if (perf >= 70) response = `@${username} üíö ƒ∞Yƒ∞! ${perf}% √ßƒ±ktƒ±! üëç`;
  else response = `@${username} ‚ö™ ${perf}% √ßƒ±ktƒ±. Tekrar dene! üîÑ`;
  
  socket.send(`PRIVMSG #${currentChannel} :${response}`);
  logToOutput(`Perf: ${perf}% (${username}) - Cooldown ba≈üladƒ±: ${cooldownSuresi}s`);
}
          }
          
          else if (chatMsg === '!dc') {
            socket.send(`PRIVMSG #${currentChannel} :@${username} üíú Discord: https://discord.gg/jf6cXAJFx5`);
          }
          
          else if (chatMsg === '!yt') {
            socket.send(`PRIVMSG #${currentChannel} :@${username} üé¨ YouTube: https://www.youtube.com/@davidkaan2246`);
          }
          
          else if (chatMsg === '!ref') {
            socket.send(`PRIVMSG #${currentChannel} :@${username} üéÅ BONUS: https://rising.merlis.eu/ref/david`);
          }
          
          else if (chatMsg === '!yardƒ±m') {
            socket.send(`PRIVMSG #${currentChannel} :@${username} üìã Komutlar: !perf | !dc | !yt | !ref | !cekilis`);
          }
          
          else if (cekilisAktif && (chatMsg === `!${cekilisKomutu}` || chatMsg.startsWith(`!${cekilisKomutu} `))) {
            cekiliseKatil(username);
          }
        }
      }
    });

    socket.addEventListener('error', () => {
      document.getElementById('status').style.background = '#e91916';
      document.getElementById('status').textContent = '‚ùå Baƒülantƒ± hatasƒ±';
    });

    socket.addEventListener('close', () => {
      document.getElementById('status').style.background = '#ff9800';
      document.getElementById('status').textContent = '‚ö†Ô∏è Yeniden baƒülanƒ±yor...';
      setTimeout(connectToTwitch, 5000);
    });

  } catch (error) {
    logToOutput(`Hata: ${error}`);
  }
}

// TEST FONKSƒ∞YONLARI
function baglantiTest() {
  if (socket && socket.readyState === WebSocket.OPEN) {
    logToOutput('‚úì Baƒülantƒ± aktif');
  } else {
    logToOutput('‚úó Baƒülantƒ± kapalƒ±');
  }
}

function perfTestiYap() {
  const perf = hesaplaperf();
  logToOutput(`Test perf: ${perf}%`);
}

// BA≈ûLANGI√á
window.addEventListener('load', () => {
  araliklariGuncelle();
  connectToTwitch();
});
</script>
</body>
</html>
